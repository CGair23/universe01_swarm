#!/usr/bin/env python3
import pytest
from coder_lib import decode_many


def test_multi_decode():
    data = "00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096761766f66796f726b0000000000000000000000000000000000000000000000"
    ret = decode_many(["bool", "string", "bool"], data)
    expected = "bool true\nstring gavofyork\nbool false"
    assert ret == expected


def test_dynamic_decode():
    data = "0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000005126fe53ffffffffffffffffffffffffffffffffffffffffffffffffffffffffcfebbd9e00000000000000000000000000000000000000000000000000000000816c33e800000000000000000000000000000000000000000000000000000000e453ea6900000000000000000000000000000000000000000000000000000001609eea84ffffffffffffffffffffffffffffffffffffffffffffffffffffffff14d90dc2000000000000000000000000000000000000000000000000000000016634ac4a00000000000000000000000000000000000000000000000000000000140ae441ffffffffffffffffffffffffffffffffffffffffffffffffffffffffeb4ddba5000000000000000000000000000000000000000000000000000000001ba7509e000000000000000000000000000000000000000000000000000000005d5f04f000000000000000000000000000000000000000000000000000000001e61e2be100000000000000000000000000000000000000000000000000000001096f738fffffffffffffffffffffffffffffffffffffffffffffffffffffffff9d91d009ffffffffffffffffffffffffffffffffffffffffffffffffffffffffa89e521bffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd184e6000000000000000000000000000000000000000000000000000000008d4ffb7e00000000000000000000000000000000000000000000000000000000f19599c400000000000000000000000000000000000000000000000000000000a3909e6a00000000000000000000000000000000000000000000000000000000e73ec4c000000000000000000000000000000000000000000000000000000000b5f3de33000000000000000000000000000000000000000000000000000000010b0cd3ff00000000000000000000000000000000000000000000000000000000aef508fa0000000000000000000000000000000000000000000000000000000125b0efe10000000000000000000000000000000000000000000000000000000007f1c3e200000000000000000000000000000000000000000000000000000000c3ce922c000000000000000000000000000000000000000000000000000000014a63874800000000000000000000000000000000000000000000000000000000219024ed0000000000000000000000000000000000000000000000000000000120be53eb000000000000000000000000000000000000000000000000000000013081f1df00000000000000000000000000000000000000000000000000000001011ab928000000000000000000000000000000000000000000000000000000006c1fe5d900000000000000000000000000000000000000000000000000000000ad2ba75a00000000000000000000000000000000000000000000000000000000f1b7f695000000000000000000000000000000000000000000000000000000004555a307ffffffffffffffffffffffffffffffffffffffffffffffffffffffffac60df48ffffffffffffffffffffffffffffffffffffffffffffffffffffffffae9865c400000000000000000000000000000000000000000000000000000000b4221eda00000000000000000000000000000000000000000000000000000000e46553aa0000000000000000000000000000000000000000000000000000000041cdbb76ffffffffffffffffffffffffffffffffffffffffffffffffffffffff9e9f33a800000000000000000000000000000000000000000000000000000001228f929effffffffffffffffffffffffffffffffffffffffffffffffffffffffdf729a7c00000000000000000000000000000000000000000000000000000000f5c09dc4ffffffffffffffffffffffffffffffffffffffffffffffffffffffff71f2d3ea00000000000000000000000000000000000000000000000000000000229ca71400000000000000000000000000000000000000000000000000000000f4c8e02800000000000000000000000000000000000000000000000000000000e756e7de000000000000000000000000000000000000000000000000000000005f9f3485ffffffffffffffffffffffffffffffffffffffffffffffffffffffff550b028200000000000000000000000000000000000000000000000000000000855d312200000000000000000000000000000000000000000000000000000000ad2304eb0000000000000000000000000000000000000000000000000000000130bf1c7600000000000000000000000000000000000000000000000000000000f9897ecc00000000000000000000000000000000000000000000000000000000f5f6ba7600000000000000000000000000000000000000000000000000000001b6d23bb9000000000000000000000000000000000000000000000000000000004177d53fffffffffffffffffffffffffffffffffffffffffffffffffffffffff906652b50000000000000000000000000000000000000000000000000000000051c847ee00000000000000000000000000000000000000000000000000000000aa0609f90000000000000000000000000000000000000000000000000000000028288b5e00000000000000000000000000000000000000000000000000000001bdcf3fca00000000000000000000000000000000000000000000000000000000f0c49c020000000000000000000000000000000000000000000000000000000025fb6c5900000000000000000000000000000000000000000000000000000000595c209700000000000000000000000000000000000000000000000000000000357878e300000000000000000000000000000000000000000000000000000001194ac5a9ffffffffffffffffffffffffffffffffffffffffffffffffffffffff5881513e0000000000000000000000000000000000000000000000000000000071a217f200000000000000000000000000000000000000000000000000000000d8dbedceffffffffffffffffffffffffffffffffffffffffffffffffffffffff7728e2ff00000000000000000000000000000000000000000000000000000000c3543d2e0000000000000000000000000000000000000000000000000000000105bcea860000000000000000000000000000000000000000000000000000000024bab93d00000000000000000000000000000000000000000000000000000000e7b02f7500000000000000000000000000000000000000000000000000000000dd165aa600000000000000000000000000000000000000000000000000000000f8e11e3400000000000000000000000000000000000000000000000000000000bdbdd43dfffffffffffffffffffffffffffffffffffffffffffffffffffffffffe4c8f9a00000000000000000000000000000000000000000000000000000000ec536688ffffffffffffffffffffffffffffffffffffffffffffffffffffffffea9f153c0000000000000000000000000000000000000000000000000000000061f0b30500000000000000000000000000000000000000000000000000000000379e76ad0000000000000000000000000000000000000000000000000000000079cfa49e0000000000000000000000000000000000000000000000000000000075a408300000000000000000000000000000000000000000000000000000000099a41034000000000000000000000000000000000000000000000000000000006a7b2b4d000000000000000000000000000000000000000000000000000000005bc99822ffffffffffffffffffffffffffffffffffffffffffffffffffffffffd3e6659400000000000000000000000000000000000000000000000000000000cc12ee4d00000000000000000000000000000000000000000000000000000001287581240000000000000000000000000000000000000000000000000000000065efa0e0fffffffffffffffffffffffffffffffffffffffffffffffffffffffff98edf79000000000000000000000000000000000000000000000000000000011deaa94e000000000000000000000000000000000000000000000000000000008194c73e0000000000000000000000000000000000000000000000000000000067561257000000000000000000000000000000000000000000000000000000015dd821000000000000000000000000000000000000000000000000000000000083c1a5a1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffb2c4eeb000000000000000000000000000000000000000000000000000000000a3faf168000000000000000000000000000000000000000000000000000000001298c001fffffffffffffffffffffffffffffffffffffffffffffffffffffffff772fad6000000000000000000000000000000000000000000000000000000015ba4d03f000000000000000000000000000000000000000000000000000000000614822fffffffffffffffffffffffffffffffffffffffffffffffffffffffffd8ae7d12ffffffffffffffffffffffffffffffffffffffffffffffffffffffffab6aad7bffffffffffffffffffffffffffffffffffffffffffffffffffffffffeb4c98b80000000000000000000000000000000000000000000000000000000013421d6f0000000000000000000000000000000000000000000000000000000020d174580000000000000000000000000000000000000000000000000000000010b98cd0000000000000000000000000000000000000000000000000000000006f27cdc300000000000000000000000000000000000000000000000000000001533414d9ffffffffffffffffffffffffffffffffffffffffffffffffffffffff8dfe5d1b0000000000000000000000000000000000000000000000000000000144e6bee400000000000000000000000000000000000000000000000000000000c5c8cacd00000000000000000000000000000000000000000000000000000000be4b3f670000000000000000000000000000000000000000000000000000000074b091c900000000000000000000000000000000000000000000000000000001143bb5020000000000000000000000000000000000000000000000000000000187974cc5ffffffffffffffffffffffffffffffffffffffffffffffffffffffffe5d575ef000000000000000000000000000000000000000000000000000000000ec81ed20000000000000000000000000000000000000000000000000000000017c34fc700000000000000000000000000000000000000000000000000000000169dccf7000000000000000000000000000000000000000000000000000000006dbab51500000000000000000000000000000000000000000000000000000000d1986fe900000000000000000000000000000000000000000000000000000000d52b3c40000000000000000000000000000000000000000000000000000000006948e49b00000000000000000000000000000000000000000000000000000000e76755b9"
    ret = decode_many(["uint256", "uint64", "int128[]"], data)

    ret = ret.split("\n")
    ret = ret[2].split(" ")
    ret = ret[1]
    print(f"DECODED = {ret}, len = {len(ret)}")